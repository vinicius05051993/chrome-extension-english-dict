<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Meu Site Simples</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
    </style>
</head>
<body>
<h1>Bem-vindo ao meu site!</h1>
<p>Este é um site simples hospedado no GitHub Pages.</p>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // Busca word.word e phase.phase para o usuário pelo email
    window.addEventListener('DOMContentLoaded', async function () {
        const SUPABASE_URL = 'https://wgkakdbjxdqfdshqodtw.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indna2FrZGJqeGRxZmRzaHFvZHR3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjM2NjQ0NzcsImV4cCI6MjAzOTI0MDQ3N30.yAEn_IPXMxK4holhx9osY8nwHPVQIuF8bPZ7_asV0KM';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const params = new URLSearchParams(window.location.search);
        const email = params.get('email');

        // Busca o id do usuário pelo email
        const { data: userData, error: userError } = await supabase
            .from('user')
            .select('id')
            .eq('user', email)
            .single();

        if (userError || !userData) {
            console.error(userError || 'Usuário não encontrado');
            return;
        }

// 2. Busca as palavras do usuário
        const { data: userWords, error: userWordsError } = await supabase
            .from('user_word')
            .select('word')
            .eq('user', userData.id);

        if (userWordsError) {
            console.error(userWordsError);
            return;
        }

// 3. Para cada palavra, busca a fase correspondente
        const resultado = [];
        for (const uw of userWords) {
            const { data: wordData } = await supabase
                .from('word')
                .select('word')
                .eq('id', uw.word)
                .single();

            const { data: wordPhase } = await supabase
                .from('word_phase')
                .select('phase')
                .eq('word', uw.word)
                .single();

            let phaseName = null;
            if (wordPhase && wordPhase.phase) {
                const { data: phaseData } = await supabase
                    .from('phase')
                    .select('phase')
                    .eq('id', wordPhase.phase)
                    .single();
                if (phaseData) {
                    phaseName = phaseData.phase;
                } else {
                    console.log('Phase não encontrada para id:', wordPhase.phase);
                }
            } else {
                console.log('wordPhase ou wordPhase.phase não encontrado para word:', uw.word);
            }

            resultado.push({
                word: wordData?.word || null,
                phase: phaseName
            });
        }

        console.log(resultado);
    });
</script>

</body>
</html>